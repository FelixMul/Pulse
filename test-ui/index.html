<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parliament Pulse - Model Testing Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 600px;
        }

        .email-section {
            padding: 30px;
            border-right: 1px solid #e2e8f0;
        }

        .prediction-section {
            padding: 30px;
            background: #f8fafc;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .email-list {
            max-height: 500px;
            overflow-y: auto;
            space-y: 15px;
        }

        .email-card {
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .email-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }

        .email-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea10 0%, #764ba210 100%);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);
        }

        .email-subject {
            font-weight: 600;
            font-size: 1.1rem;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .email-preview {
            color: #4a5568;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 12px;
        }

        .email-labels {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 8px;
        }

        .label {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 500;
        }

        .topic-label {
            background: #e6fffa;
            color: #0d9488;
            border: 1px solid #0d948820;
        }

        .sentiment-label {
            background: #fef3c7;
            color: #d97706;
            border: 1px solid #d9770620;
        }

        .prediction-results {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .results-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #718096;
            text-align: center;
            font-size: 1.1rem;
        }

        .results-content {
            display: none;
        }

        .results-content.show {
            display: block;
        }

        .prediction-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }

        .prediction-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .topic-prediction {
            margin-bottom: 10px;
        }

        .topic-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .topic-item:last-child {
            border-bottom: none;
        }

        .confidence-score {
            font-weight: 600;
            color: #059669;
        }

        .sentiment-score {
            font-size: 1.2rem;
            font-weight: 600;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .sentiment-positive { background: #dcfce7; color: #16a34a; }
        .sentiment-negative { background: #fef2f2; color: #dc2626; }
        .sentiment-neutral { background: #f1f5f9; color: #64748b; }

        .accuracy-section {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 15px;
        }

        .accuracy-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .accuracy-item:last-child {
            margin-bottom: 0;
        }

        .status-correct {
            color: #16a34a;
            font-weight: 600;
        }

        .status-incorrect {
            color: #dc2626;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #718096;
        }

        .error {
            background: #fef2f2;
            color: #dc2626;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .email-section {
                border-right: none;
                border-bottom: 1px solid #e2e8f0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèõÔ∏è Parliament Pulse</h1>
            <p>Model Testing Interface - Test Dataset Analysis</p>
        </div>

        <div class="main-content">
            <!-- Email Selection Section -->
            <div class="email-section">
                <h2 class="section-title">
                    üìß Test Emails
                    <span id="email-count" style="font-size: 0.9rem; color: #718096;">(Loading...)</span>
                </h2>
                
                <div id="loading-emails" class="loading">
                    Loading test emails...
                </div>
                
                <div id="email-error" class="error" style="display: none;">
                </div>
                
                <div id="email-list" class="email-list">
                    <!-- Emails will be loaded here -->
                </div>
            </div>

            <!-- Prediction Results Section -->
            <div class="prediction-section">
                <h2 class="section-title">
                    ü§ñ Prediction Results
                </h2>
                
                <div class="prediction-results">
                    <div id="results-placeholder" class="results-placeholder">
                        üëÜ Select an email to see predictions vs ground truth
                    </div>
                    
                    <div id="results-content" class="results-content">
                        <div id="prediction-loading" class="loading" style="display: none;">
                            üîÑ Running predictions...
                        </div>
                        
                        <div id="prediction-error" class="error" style="display: none;">
                        </div>
                        
                        <!-- Model Predictions -->
                        <div class="prediction-card">
                            <h3 class="prediction-title">ü§ñ LLM Analysis (gpt-oss 20B)</h3>
                            
                            <div style="margin-bottom: 20px;">
                                <h4 style="margin-bottom: 10px; color: #4a5568;">Topic Classification:</h4>
                                <div id="predicted-topics">
                                    <!-- Topic predictions will appear here -->
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h4 style="margin-bottom: 10px; color: #4a5568;">Sentiment Analysis:</h4>
                                <div id="predicted-sentiment">
                                    <!-- Sentiment prediction will appear here -->
                                </div>
                            </div>
                            
                            <div>
                                <h4 style="margin-bottom: 10px; color: #4a5568;">Summary:</h4>
                                <div id="predicted-summary">
                                    <!-- Summary will appear here -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ground Truth -->
                        <div class="prediction-card">
                            <h3 class="prediction-title">üìã Ground Truth Labels</h3>
                            
                            <div style="margin-bottom: 20px;">
                                <h4 style="margin-bottom: 10px; color: #4a5568;">True Topics:</h4>
                                <div id="true-topics">
                                    <!-- True topics will appear here -->
                                </div>
                            </div>
                            
                            <div>
                                <h4 style="margin-bottom: 10px; color: #4a5568;">True Sentiment:</h4>
                                <div id="true-sentiment">
                                    <!-- True sentiment will appear here -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Accuracy Assessment -->
                        <div class="accuracy-section">
                            <h3 class="prediction-title">‚úÖ Accuracy Assessment</h3>
                            <div id="accuracy-results">
                                <!-- Accuracy comparison will appear here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let testEmails = [];
        let selectedEmail = null;
        
        // Load test emails on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadTestEmails();
        });
        
        // Load emails from test dataset
        async function loadTestEmails() {
            console.log('üîç Starting to load test emails...');
            
            try {
                // Use absolute path from server root for local dev
                // Make sure to serve the file from the workspace root or symlink/copy as needed
                const csvUrl = '/data/email_dataset_test.csv';
                console.log('üì° Fetching CSV from:', csvUrl);
                
                const response = await fetch(csvUrl);
                console.log('üì• Response status:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const csvText = await response.text();
                console.log('üìÑ CSV text length:', csvText.length);
                console.log('üìÑ First 200 characters:', csvText.substring(0, 200));
                
                testEmails = parseCSV(csvText);
                console.log('‚úÖ Parsed emails count:', testEmails.length);
                console.log('üìß First email sample:', testEmails[0]);
                
                displayEmails(testEmails);
                
                document.getElementById('email-count').textContent = `(${testEmails.length} emails)`;
                document.getElementById('loading-emails').style.display = 'none';
                
            } catch (error) {
                console.error('‚ùå Error loading test emails:', error);
                document.getElementById('loading-emails').style.display = 'none';
                document.getElementById('email-error').style.display = 'block';
                document.getElementById('email-error').textContent = `Error loading test emails: ${error.message}. Make sure you're running a static server from the project root (python3 -m http.server 8080) and accessing via http://localhost:8080/test-ui/index.html`;
            }
        }
        
        // Robust CSV parser that handles multi-line content
        function parseCSV(csvText) {
            console.log('üîç Starting CSV parsing with multi-line support...');
            
            const emails = [];
            const rows = parseCSVRows(csvText);
            
            if (rows.length === 0) {
                console.error('‚ùå No CSV rows found');
                return emails;
            }
            
            const headers = rows[0];
            console.log('üìã CSV Headers:', headers);
            
            for (let i = 1; i < rows.length; i++) {
                const values = rows[i];
                if (values.length === 0) continue;
                
                const email = {};
                headers.forEach((header, index) => {
                    email[header] = values[index] || '';
                });
                
                // Debug first email to see actual content
                if (i === 1) {
                    console.log('üìß First email email_body length:', email.email_body ? email.email_body.length : 'undefined');
                    console.log('üìß First email email_body preview:', email.email_body ? email.email_body.substring(0, 200) : 'undefined');
                }
                
                // Check if email has required fields
                if (email.email_body && email.topics && email.email_body.length > 10) {
                    emails.push(email);
                } else {
                    console.log(`‚ö†Ô∏è Skipping email at row ${i+1}: missing email_body or topics (body length: ${email.email_body ? email.email_body.length : 0})`);
                }
            }
            
            console.log(`‚úÖ Successfully parsed ${emails.length} emails out of ${rows.length-1} total rows`);
            return emails;
        }
        
        // Robust CSV parser that handles multi-line quoted fields
        function parseCSVRows(csvText) {
            const rows = [];
            let currentRow = [];
            let currentField = '';
            let inQuotes = false;
            let i = 0;
            
            while (i < csvText.length) {
                const char = csvText[i];
                const nextChar = csvText[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        // Escaped quote inside quoted field
                        currentField += '"';
                        i += 2;
                        continue;
                    } else {
                        // Start or end of quoted field
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    // Field separator
                    currentRow.push(currentField.trim());
                    currentField = '';
                } else if ((char === '\n' || char === '\r') && !inQuotes) {
                    // Row separator
                    if (currentField || currentRow.length > 0) {
                        currentRow.push(currentField.trim());
                        if (currentRow.length > 0 && currentRow.some(field => field.length > 0)) {
                            rows.push(currentRow);
                        }
                        currentRow = [];
                        currentField = '';
                    }
                    // Skip \r\n sequences
                    if (char === '\r' && nextChar === '\n') {
                        i++;
                    }
                } else {
                    // Regular character
                    currentField += char;
                }
                
                i++;
            }
            
            // Handle last field and row
            if (currentField || currentRow.length > 0) {
                currentRow.push(currentField.trim());
                if (currentRow.length > 0 && currentRow.some(field => field.length > 0)) {
                    rows.push(currentRow);
                }
            }
            
            return rows;
        }
        
        // Parse CSV line handling quoted values (legacy - kept for compatibility)
        function parseCSVLine(line) {
            const values = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    values.push(current.trim().replace(/"/g, ''));
                    current = '';
                } else {
                    current += char;
                }
            }
            
            values.push(current.trim().replace(/"/g, ''));
            return values;
        }
        
        // Display emails in the list
        function displayEmails(emails) {
            const emailList = document.getElementById('email-list');
            emailList.innerHTML = '';
            
            emails.forEach((email, index) => {
                const emailCard = createEmailCard(email, index);
                emailList.appendChild(emailCard);
            });
        }
        
        // Create email card element
        function createEmailCard(email, index) {
            const card = document.createElement('div');
            card.className = 'email-card';
            card.dataset.index = index;
            
            // Parse topics
            const topics = parseTopics(email.topics);
            const sentiment = email.sentiment || 'Unknown';
            
            // Get subject line - use actual subject_line field
            let subject = email.subject_line || email.subject || '';
            if (!subject || subject.trim() === '') {
                // Generate fallback only if truly empty
                const firstWords = email.email_body.split(' ').slice(0, 8).join(' ');
                subject = firstWords.length > 50 ? firstWords + '...' : firstWords;
            }
            
            // Debug log to see what fields we actually have
            if (index === 0) {
                console.log('üìß First email fields:', Object.keys(email));
                console.log('üìß Subject field value:', email.subject_line);
                console.log('üìß Generated subject:', subject);
            }
            
            card.innerHTML = `
                <div class="email-subject">${subject}</div>
                <div class="email-preview">${truncateText(email.email_body, 120)}</div>
                <div class="email-labels">
                    ${topics.map(topic => `<span class="label topic-label">${topic}</span>`).join('')}
                    <span class="label sentiment-label">${sentiment}</span>
                </div>
            `;
            
            card.addEventListener('click', () => selectEmail(index));
            
            return card;
        }
        
        // Parse topics from string representation
        function parseTopics(topicsStr) {
            try {
                // Handle different topic string formats
                if (topicsStr.includes('[') && topicsStr.includes(']')) {
                    // Parse array-like string
                    const cleaned = topicsStr.replace(/[\[\]]/g, '').replace(/'/g, '"');
                    return cleaned.split(',').map(t => t.trim().replace(/"/g, ''));
                } else {
                    // Single topic or comma-separated
                    return topicsStr.split(',').map(t => t.trim());
                }
            } catch (error) {
                console.error('Error parsing topics:', error);
                return [topicsStr];
            }
        }
        
        // Truncate text
        function truncateText(text, length) {
            if (text.length <= length) return text;
            return text.substring(0, length) + '...';
        }
        
        // Select an email
        function selectEmail(index) {
            // Remove previous selection
            document.querySelectorAll('.email-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Select new email
            document.querySelector(`[data-index="${index}"]`).classList.add('selected');
            selectedEmail = testEmails[index];
            
            // Show results section
            document.getElementById('results-placeholder').style.display = 'none';
            document.getElementById('results-content').classList.add('show');
            
            // Show ground truth immediately
            displayGroundTruth(selectedEmail);
            
            // Run analysis (will use cache if already analyzed)
            runPredictions(selectedEmail, index);
        }
        
        // Update email card to show analysis status
        function updateEmailCardStatus(index, isAnalyzed) {
            const card = document.querySelector(`[data-index="${index}"]`);
            if (card && isAnalyzed) {
                // Add a visual indicator that this email has been analyzed
                if (!card.querySelector('.analyzed-indicator')) {
                    const indicator = document.createElement('div');
                    indicator.className = 'analyzed-indicator';
                    indicator.innerHTML = '‚úì Analyzed';
                    indicator.style.cssText = `
                        position: absolute;
                        top: 8px;
                        right: 8px;
                        background: #16a34a;
                        color: white;
                        padding: 2px 6px;
                        border-radius: 4px;
                        font-size: 0.7rem;
                        font-weight: bold;
                    `;
                    card.style.position = 'relative';
                    card.appendChild(indicator);
                }
            }
        }
        
        // Display ground truth labels
        function displayGroundTruth(email) {
            const topics = parseTopics(email.topics);
            const sentiment = email.sentiment || 'Unknown';
            
            // Display true topics
            const trueTopicsDiv = document.getElementById('true-topics');
            trueTopicsDiv.innerHTML = topics.map(topic => 
                `<span class="label topic-label">${topic}</span>`
            ).join(' ');
            
            // Display true sentiment
            const trueSentimentDiv = document.getElementById('true-sentiment');
            trueSentimentDiv.innerHTML = `<span class="label sentiment-label">${sentiment}</span>`;
        }
        
        // Track analyzed emails to show status
        let analyzedEmails = new Set();
        
        // Run analysis (uses email ID for caching)
        async function runPredictions(email, emailIndex) {
            document.getElementById('prediction-loading').style.display = 'block';
            document.getElementById('prediction-error').style.display = 'none';
            
            // Generate consistent email ID based on content
            const emailId = `email_${emailIndex}_${btoa(email.email_body.substring(0, 100)).replace(/[^a-zA-Z0-9]/g, '').substring(0, 20)}`;
            
            try {
                // Call backend API for analysis with email ID for caching
                const response = await fetch('http://localhost:8080/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: email.email_body,
                        subject: email.subject_line || "Test Email",
                        email_id: emailId
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    // Mark email as analyzed
                    analyzedEmails.add(emailIndex);
                    updateEmailCardStatus(emailIndex, true);
                    displayPredictions(data, email);
                } else {
                    throw new Error(data.message || 'Analysis failed');
                }
                
            } catch (error) {
                console.error('Error running analysis:', error);
                document.getElementById('prediction-loading').style.display = 'none';
                document.getElementById('prediction-error').style.display = 'block';
                document.getElementById('prediction-error').textContent = 
                    'Error running analysis: ' + error.message + ' (Make sure the server is running on port 8080)';
            }
        }
        
        // Display predictions and compare with ground truth
        function displayPredictions(data, email) {
            document.getElementById('prediction-loading').style.display = 'none';
            
            // Show analysis status message
            const isCache = data.message && data.message.includes('Cached');
            if (isCache) {
                console.log('üìã Using cached analysis result');
            }
            
            // Display predicted topic
            const predictedTopicsDiv = document.getElementById('predicted-topics');
            if (data.topic) {
                predictedTopicsDiv.innerHTML = `
                    <div class="topic-item">
                        <span style="font-weight: 600; color: #2d3748;">${data.topic}</span>
                        <span class="confidence-score">${(data.confidence * 100).toFixed(1)}%</span>
                    </div>
                    ${isCache ? '<div style="font-size: 0.8rem; color: #6b7280; margin-top: 5px;">üìã Cached result</div>' : ''}
                `;
            } else {
                predictedTopicsDiv.innerHTML = '<div style="color: #718096; font-style: italic;">No topic predicted</div>';
            }
            
            // Display predicted sentiment
            const predictedSentimentDiv = document.getElementById('predicted-sentiment');
            if (data.sentiment) {
                const sentiment = data.sentiment.replace('_', ' ').toUpperCase();
                
                const sentimentClass = data.sentiment.includes('positive') ? 'sentiment-positive' : 
                                     data.sentiment.includes('negative') ? 'sentiment-negative' : 'sentiment-neutral';
                
                predictedSentimentDiv.innerHTML = `
                    <div class="sentiment-score ${sentimentClass}">
                        ${sentiment}
                        <div style="font-size: 0.9rem; margin-top: 5px;">
                            Confidence: ${(data.confidence * 100).toFixed(1)}%
                        </div>
                    </div>
                `;
            } else {
                predictedSentimentDiv.innerHTML = '<div style="color: #718096; font-style: italic;">Sentiment analysis failed</div>';
            }
            
            // Display summary
            const predictedSummaryDiv = document.getElementById('predicted-summary');
            if (data.summary) {
                predictedSummaryDiv.innerHTML = `
                    <div style="background: #f8fafc; padding: 12px; border-radius: 6px; font-style: italic; color: #374151;">
                        "${data.summary}"
                    </div>
                `;
            } else {
                predictedSummaryDiv.innerHTML = '<div style="color: #718096; font-style: italic;">No summary available</div>';
            }
            
            // Calculate and display accuracy
            calculateAccuracy(data, email);
        }
        
        // Calculate accuracy comparison
        function calculateAccuracy(predictions, email) {
            const accuracyDiv = document.getElementById('accuracy-results');
            
            // Parse true topics
            const trueTopics = parseTopics(email.topics);
            const trueSentiment = email.sentiment || 'Unknown';
            
            // Topic accuracy (simplified for single topic)
            const predictedTopic = predictions.topic || 'Unknown';
            const topicMatch = trueTopics.includes(predictedTopic);
            const topicAccuracy = topicMatch ? 1.0 : 0.0;
            
            // Sentiment accuracy
            const predictedSentiment = predictions.sentiment || 'Unknown';
            const sentimentMatch = predictedSentiment.toLowerCase() === trueSentiment.toLowerCase();
            
            // Topic analysis (simplified)
            const missedTopics = topicMatch ? [] : trueTopics;
            const extraTopics = topicMatch ? [] : [predictedTopic];
            
            let accuracyHTML = `
                <div class="accuracy-item">
                    <span>Topic Accuracy:</span>
                    <span class="${topicAccuracy >= 0.5 ? 'status-correct' : 'status-incorrect'}">
                        ${topicMatch ? 'Correct' : 'Incorrect'} (${(topicAccuracy * 100).toFixed(1)}%)
                    </span>
                </div>
                
                <div class="accuracy-item">
                    <span>Sentiment Accuracy:</span>
                    <span class="${sentimentMatch ? 'status-correct' : 'status-incorrect'}">
                        ${sentimentMatch ? '‚úì Correct' : '‚úó Incorrect'}
                    </span>
                </div>
            `;
            
            // Add detailed topic analysis
            if (topicMatch) {
                accuracyHTML += `
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e2e8f0;">
                        <strong style="color: #16a34a;">‚úì Correctly Identified Topic:</strong>
                        <div style="margin-top: 5px;">
                            <span class="label topic-label" style="margin: 2px;">${predictedTopic}</span>
                        </div>
                    </div>
                `;
            }
            
            if (missedTopics.length > 0) {
                accuracyHTML += `
                    <div style="margin-top: 10px;">
                        <strong style="color: #dc2626;">‚úó Missed Topics:</strong>
                        <div style="margin-top: 5px;">
                            ${missedTopics.map(topic => `<span class="label" style="background: #fef2f2; color: #dc2626; margin: 2px;">${topic}</span>`).join('')}
                        </div>
                    </div>
                `;
            }
            
            if (extraTopics.length > 0 && extraTopics[0] !== 'Unknown') {
                accuracyHTML += `
                    <div style="margin-top: 10px;">
                        <strong style="color: #d97706;">‚ö† Extra/Wrong Topic:</strong>
                        <div style="margin-top: 5px;">
                            ${extraTopics.map(topic => `<span class="label" style="background: #fef3c7; color: #d97706; margin: 2px;">${topic}</span>`).join('')}
                        </div>
                    </div>
                `;
            }
            
            // Overall assessment
            const overallScore = (topicAccuracy + (sentimentMatch ? 1 : 0)) / 2;
            let assessmentColor = overallScore >= 0.7 ? '#16a34a' : overallScore >= 0.4 ? '#d97706' : '#dc2626';
            let assessmentText = overallScore >= 0.7 ? 'Good' : overallScore >= 0.4 ? 'Fair' : 'Poor';
            
            accuracyHTML += `
                <div style="margin-top: 15px; padding: 10px; background: #f8fafc; border-radius: 6px; text-align: center;">
                    <strong style="color: ${assessmentColor};">Overall Assessment: ${assessmentText}</strong>
                    <div style="color: #4a5568; font-size: 0.9rem; margin-top: 5px;">
                        Combined Score: ${(overallScore * 100).toFixed(1)}%
                    </div>
                </div>
            `;
            
            accuracyDiv.innerHTML = accuracyHTML;
        }
    </script>
</body>
</html> 
</html> 